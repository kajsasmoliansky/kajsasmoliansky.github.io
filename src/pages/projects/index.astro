---
import { Image } from 'astro:assets';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const sortedProjects = projects.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<BaseLayout title="Projekt" description="Projekt och uppdateringar från Kajsa Smolianskys arbete med byggnadsrestaurering">
  <div class="page-intro">
    <h1>Projekt</h1>
    <p class="lead">Dokumentation och uppdateringar från pågående och avslutade restaureringsprojekt.</p>
  </div>

  {sortedProjects.length > 0 ? (
    <ul class="project-list">
      {sortedProjects.map((project) => {
        const formattedDate = project.data.date.toLocaleDateString('sv-SE', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        return (
          <li class="project-card">
            {project.data.image && (
              <a href={`/projects/${project.slug}/`} class="project-card-image">
                <Image src={project.data.image} alt={project.data.title} width={600} />
              </a>
            )}
            <p class="date">{formattedDate}</p>
            <h2>
              <a href={`/projects/${project.slug}/`}>
                {project.data.title}
              </a>
            </h2>
            {project.data.description && (
              <p class="description">{project.data.description}</p>
            )}
          </li>
        );
      })}
    </ul>
  ) : (
    <div class="empty-state">
      <p>Inga projekt publicerade ännu.</p>
    </div>
  )}
</BaseLayout>
